<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Status Roblox Vilog</title>
<style>
  body { background:#0b0b0b; color:#f2f2f2; font-family: Arial, sans-serif; padding:16px; }
  h1 { text-align:center; margin-bottom:20px; }
  .row { display:flex; justify-content:space-between; align-items:center; padding:8px; margin-bottom:4px; border-radius:6px; background:#141414; }
  .status { padding:2px 8px; border-radius:4px; color:white; font-size:12px; }
  .pending { background: #6b7280; } /* abu-abu */
  .proses { background: #2563eb; } /* biru */
  .success { background: #16a34a; } /* hijau */

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: #0b0b0b;
      color: #f2f2f2;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 16px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #ffffff;
    }
    .card {
      background: #141414;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      border: 2px solid transparent;
      position: relative;
    }
    .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin: 6px 0;
      font-size: 14px;
    }
    .label {
      color: #9ca3af;
      min-width: 110px;
    }
    .value {
      word-break: break-all;
    }
    button {
      background: #2563eb;
      border: none;
      color: white;
      padding: 4px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }
    button:hover {
      background: #1d4ed8;
    }
    .rbx {
      margin-top: 10px;
      font-weight: bold;
      color: #22c55e;
    }
    .footer {
      text-align: center;
      margin-top: 30px;
      font-size: 12px;
      color: #6b7280;
    }
    .status-btn {
      margin-top: 10px;
      background: #16a34a;
      padding: 8px 16px;
      font-size: 12px;
    }
    .status-btn:hover {
      background: #15803d;
    }
    .add-data-btn {
      background: #f59e0b;
      margin-bottom: 20px;
      padding: 8px 16px;
      font-size: 14px;
    }
    .add-data-btn:hover {
      background: #d97706;
    }
    .form-container {
      background: #1a1a1a;
      border: 2px solid #4b5563;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      display: none;
    }
    .form-container.show {
      display: block;
    }
    .form-group {
      margin-bottom: 12px;
    }
    .form-group label {
      display: block;
      color: #9ca3af;
      font-weight: bold;
      margin-bottom: 6px;
      font-size: 13px;
    }
    .form-group input {
      width: 100%;
      padding: 8px 12px;
      background: #0b0b0b;
      border: 1px solid #4b5563;
      border-radius: 6px;
      color: #f2f2f2;
      font-size: 14px;
      box-sizing: border-box;
    }
    .form-group input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
    }
    .backup-fields {
      background: #141414;
      border-left: 3px solid #2563eb;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 12px;
    }
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 16px;
    }
    .add-backup-btn {
      background: #06b6d4;
      padding: 6px 12px;
      font-size: 12px;
    }
    .add-backup-btn:hover {
      background: #0891b2;
    }
    .finish-btn {
      background: #16a34a;
      padding: 8px 16px;
    }
    .finish-btn:hover {
      background: #15803d;
    }
    .cancel-btn {
      background: #6b7280;
      padding: 8px 16px;
    }
    .cancel-btn:hover {
      background: #4b5563;
    }
    .remove-backup-btn {
      background: #dc2626;
      padding: 4px 8px;
      font-size: 11px;
      margin-left: 8px;
    }
    .remove-backup-btn:hover {
      background: #b91c1c;
    }
    .mass-add-btn {
      background: #8b5cf6;
      margin-left: 10px;
      padding: 8px 16px;
      font-size: 14px;
    }
    .mass-add-btn:hover {
      background: #7c3aed;
    }
    .mass-add-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
    }
    .mass-add-modal.show {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .mass-add-content {
      background: #1a1a1a;
      border: 2px solid #4b5563;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .mass-add-content h2 {
      margin-top: 0;
      color: #f2f2f2;
      border-bottom: 1px solid #4b5563;
      padding-bottom: 10px;
    }
    .mass-add-textarea {
      width: 100%;
      height: 400px;
      padding: 12px;
      background: #0b0b0b;
      border: 1px solid #4b5563;
      border-radius: 6px;
      color: #f2f2f2;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      box-sizing: border-box;
      margin-bottom: 12px;
    }
    .mass-add-textarea:focus {
      outline: none;
      border-color: #8b5cf6;
      box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);
    }
    .mass-add-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    .mass-add-submit {
      background: #8b5cf6;
      padding: 8px 16px;
    }
    .mass-add-submit:hover {
      background: #7c3aed;
    }
    .export-import-btn {
      background: #ec4899;
      padding: 8px 16px;
      font-size: 14px;
    }
    .export-import-btn:hover {
      background: #db2777;
    }
    #fileInput {
      display: none;
    }
    .delete-btn {
      background: #ef4444;
      padding: 8px 16px;
      font-size: 12px;
    }
    .delete-btn:hover {
      background: #dc2626;
    }
    .action-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  
  <div class="container">
    <button onclick="window.location.href='status.html'" style="margin-bottom:10px; border: 2px solid #a0a0a0 !important; background: #1f1f1f; color: #f2f2f2;">üìä Check Status</button>
    
    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
      <button class="add-data-btn" onclick="toggleForm()">‚ûï Tambah Data</button>
      <button class="mass-add-btn" onclick="toggleMassAdd()">üìã Mass ADD Data</button>
    </div>

    <!-- Form Tambah Data -->
    <div id="formContainer" class="form-container">
      <h2 style="margin-top:0; color:#f2f2f2; border-bottom: 1px solid #4b5563; padding-bottom: 10px;">Tambah Akun Baru</h2>
      
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="inputUsername" placeholder="Masukkan username...">
      </div>

      <div class="form-group">
        <label>Password</label>
        <input type="text" id="inputPassword" placeholder="Masukkan password...">
      </div>

      <div class="form-group">
        <label>Jumlah Robux</label>
        <input type="text" id="inputRbx" placeholder="Contoh: 500 RBX">
      </div>

      <div class="form-group">
        <label style="margin-bottom: 10px;">Backup Codes</label>
        <div id="backupContainer" class="backup-fields">
          <div class="form-group" style="margin-bottom: 8px;">
            <input type="text" class="backup-input" placeholder="Backup 1...">
            <button class="remove-backup-btn" onclick="removeBackupField(this)" style="display: none;">Hapus</button>
          </div>
          <div class="form-group" style="margin-bottom: 8px;">
            <input type="text" class="backup-input" placeholder="Backup 2...">
            <button class="remove-backup-btn" onclick="removeBackupField(this)" style="display: none;">Hapus</button>
          </div>
          <div class="form-group" style="margin-bottom: 0;">
            <input type="text" class="backup-input" placeholder="Backup 3...">
            <button class="remove-backup-btn" onclick="removeBackupField(this)" style="display: none;">Hapus</button>
          </div>
        </div>
        <button class="add-backup-btn" onclick="addBackupField()" style="margin-top: 8px;">+ Tambah Backup</button>
      </div>

      <div class="form-actions">
        <button class="cancel-btn" onclick="toggleForm()">Batal</button>
        <button class="finish-btn" onclick="submitNewData()">‚úì Selesaikan</button>
      </div>
    </div>

    <!-- Mass ADD Modal -->
    <div id="massAddModal" class="mass-add-modal">
      <div class="mass-add-content">
        <h2>üìã Mass ADD Data</h2>
        <p style="color: #9ca3af; font-size: 13px; margin: 10px 0;">Paste data dalam format JSON berikut:</p>
        <textarea id="massAddTextarea" class="mass-add-textarea" placeholder='[
  {
    user: "username",
    pass: "password",
    backup: ["code1", "code2", "code3"],
    rbx: "500 RBX"
  },
  {
    user: "username2",
    pass: "password2",
    backup: ["code1", "code2", "code3"],
    rbx: "1000 RBX"
  }
]'></textarea>
        <div class="mass-add-actions">
          <button class="cancel-btn" onclick="toggleMassAdd()">Batal</button>
          <button class="mass-add-submit" onclick="submitMassAdd()">‚úì Tambahkan Semua</button>
        </div>
      </div>
    </div>
    
    <h1>üì¶ Roblox Vilog ‚Äì CelaStore</h1>

    <!-- Total Stats -->
  <div id="stats" style="margin-bottom:16px; font-size:14px;">
    Total Data: <span id="total">0</span> |
    Success: <span id="success">0</span> |
    Proses: <span id="proses">0</span> |
    Pending: <span id="pending">0</span>
  </div>

    <div id="list"></div>
    <div class="footer">¬© CelaStore ‚Äì Click to Copy</div>
  </div>

  <script>
    // Load data: prefer localStorage (previous edits), otherwise try fetch data.json, otherwise empty
    let data = [];
    const savedData = localStorage.getItem('robloxAccountsData');
    async function loadInitialData(){
      if(savedData) {
        try { data = JSON.parse(savedData); } catch(e) { data = []; }
      } else {
        try {
          const resp = await fetch('data.json', {cache: 'no-cache'});
          if(resp.ok) {
            data = await resp.json();
          } else {
            data = [];
          }
        } catch(e) {
          data = [];
        }
      }
    }

    const list = document.getElementById('list');
  const totalEl = document.getElementById('total');
  const successEl = document.getElementById('success');
  const prosesEl = document.getElementById('proses');
  const pendingEl = document.getElementById('pending');

  function updateStats(){
    const cards = document.querySelectorAll('.card');
    let success = 0;
    let proses = 0;
    let pending = 0;
    
    // Hitung berdasarkan localStorage status
    data.forEach((acc, i) => {
      const status = localStorage.getItem('status_' + i) || 'pending';
      if(status === 'success') {
        success++;
      } else if(status === 'proses') {
        proses++;
      } else {
        pending++;
      }
    });
    
    totalEl.innerText = data.length;
    successEl.innerText = success;
    prosesEl.innerText = proses;
    pendingEl.innerText = pending;
  }

  // Save current data to localStorage and also trigger a download (so user can save updated data.json)
  function persistData(){
    // always update localStorage
    localStorage.setItem('robloxAccountsData', JSON.stringify(data));
    localStorage.setItem('robloxData', JSON.stringify(data));

    // Try to POST to local save server at /save
    fetch('/save', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    }).then(res => res.json()).then(j => {
      if(j && j.ok){
        console.log('Saved to server: data.json');
      } else {
        console.log('Save server responded:', j);
      }
    }).catch(err => {
      // no server available; fallback only updates localStorage
      console.log('Save server not available, data saved to localStorage only.');
    });
  }

  // Render initial data (async load)
  (async ()=>{ await loadInitialData(); renderData(); })();

  function copyText(id){ 
    navigator.clipboard.writeText(document.getElementById(id).innerText); 
  }

  function toggleStatus(btn, i){
  const card = btn.closest('.card');
  let status = localStorage.getItem('status_' + i) || 'pending';

  if(status === 'pending'){ // pending ‚Üí proses (biru)
    card.style.borderColor = 'blue';
    status = 'proses';
  } else if(status === 'proses'){ // proses ‚Üí success (hijau)
    card.style.borderColor = 'limegreen';
    status = 'success';
  } else { // success ‚Üí pending (no border)
    card.style.borderColor = 'transparent';
    status = 'pending';
  }

  localStorage.setItem('status_' + i, status);
  updateStats();
}

  // Fungsi untuk toggle form
  function toggleForm() {
    const form = document.getElementById('formContainer');
    form.classList.toggle('show');
    if(form.classList.contains('show')) {
      form.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  // Fungsi untuk menambah backup field
  function addBackupField() {
    const container = document.getElementById('backupContainer');
    const backupCount = container.querySelectorAll('.form-group').length;
    
    const newField = document.createElement('div');
    newField.className = 'form-group';
    newField.style.marginBottom = '8px';
    newField.innerHTML = `
      <input type="text" class="backup-input" placeholder="Backup ${backupCount + 1}...">
      <button class="remove-backup-btn" onclick="removeBackupField(this)">Hapus</button>
    `;
    
    container.appendChild(newField);
  }

  // Fungsi untuk menghapus backup field
  function removeBackupField(btn) {
    btn.parentElement.remove();
    updateBackupLabels();
  }

  // Update label backup
  function updateBackupLabels() {
    const container = document.getElementById('backupContainer');
    const fields = container.querySelectorAll('.form-group');
    fields.forEach((field, idx) => {
      const input = field.querySelector('.backup-input');
      input.placeholder = `Backup ${idx + 1}...`;
      const btn = field.querySelector('.remove-backup-btn');
      if(fields.length <= 3) {
        btn.style.display = 'none';
      }
    });
  }

  // Fungsi submit form
  function submitNewData() {
    const username = document.getElementById('inputUsername').value.trim();
    const password = document.getElementById('inputPassword').value.trim();
    const rbx = document.getElementById('inputRbx').value.trim();
    
    const backupInputs = document.querySelectorAll('.backup-input');
    const backups = Array.from(backupInputs).map(input => input.value.trim()).filter(val => val);

    // Validasi
    if(!username || !password || !rbx || backups.length === 0) {
      alert('Harap isi semua field!');
      return;
    }

    // Buat object data baru
    const newData = {
      user: username,
      pass: password,
      backup: backups,
      rbx: rbx
    };

    // Tambahkan ke array data
    data.push(newData);

    // Reset form
    document.getElementById('inputUsername').value = '';
    document.getElementById('inputPassword').value = '';
    document.getElementById('inputRbx').value = '';
    document.querySelectorAll('.backup-input').forEach((input, idx) => {
      if(idx >= 3) input.parentElement.remove();
      else input.value = '';
    });
    updateBackupLabels();

    // Tutup form
    document.getElementById('formContainer').classList.remove('show');

    // Render ulang list
    renderData();
    // Persist changes (localStorage + try server save)
    persistData();
  }

  // Fungsi untuk toggle Mass Add Modal
  function toggleMassAdd() {
    const modal = document.getElementById('massAddModal');
    modal.classList.toggle('show');
  }

  // Fungsi untuk menghapus data
  function deleteData(index) {
    if(confirm(`Hapus akun "${data[index].user}"?`)) {
      data.splice(index, 1);
      // Hapus status dari localStorage
      localStorage.removeItem('status_' + index);
      renderData();
      // Persist changes (localStorage + try server save)
      persistData();
      alert('‚úì Akun berhasil dihapus!');
    }
  }

  // Fungsi submit Mass Add
  function submitMassAdd() {
    const textarea = document.getElementById('massAddTextarea');
    const jsonText = textarea.value.trim();

    if(!jsonText) {
      alert('Harap isi textarea!');
      return;
    }

    try {
      // Evaluasi JavaScript object (untuk support single quotes)
      const newData = eval('(' + jsonText + ')');

      if(!Array.isArray(newData)) {
        alert('Format harus array JSON!');
        return;
      }

      // Validasi setiap item
      for(let item of newData) {
        if(!item.user || !item.pass || !item.backup || !item.rbx) {
          alert('Setiap item harus memiliki user, pass, backup (array), dan rbx!');
          return;
        }
        if(!Array.isArray(item.backup)) {
          alert('backup harus berupa array!');
          return;
        }
      }

      // Tambahkan ke data
      data.push(...newData);

      // Clear textarea
      textarea.value = '';

      // Tutup modal
      document.getElementById('massAddModal').classList.remove('show');

      // Render ulang
      renderData();

      // Persist changes (localStorage + try server save)
      persistData();

      alert(`‚úì Berhasil menambahkan ${newData.length} akun!`);
    } catch(e) {
      alert('‚ùå Format data tidak valid!\n\nError: ' + e.message);
    }
  }

  // Fungsi render/render ulang data
  function renderData() {
    list.innerHTML = ''; // Clear existing
    
    data.forEach((acc, i) => {
      const card = document.createElement('div');
      card.className = 'card';

      card.innerHTML = `
        <div class="row"><span class="label">Username</span><span class="value" id="u${i}">${acc.user}</span><button onclick="copyText('u${i}')">Salin</button></div>
        <div class="row"><span class="label">Password</span><span class="value" id="p${i}">${acc.pass}</span><button onclick="copyText('p${i}')">Salin</button></div>
        ${acc.backup.map((b, j) => `
          <div class="row"><span class="label">Backup ${j+1}</span><span class="value" id="b${i}${j}">${b}</span><button onclick="copyText('b${i}${j}')">Salin</button></div>
        `).join('')}
        <div class="rbx">Jumlah Robux: ${acc.rbx}</div>
        <div class="action-buttons">
          <button class="delete-btn" onclick="deleteData('${i}')">üóëÔ∏è Hapus</button>
          <button class="status-btn" onclick="toggleStatus(this, '${i}')">Status</button>
        </div>
      `;

      list.appendChild(card);
      
      // Load saved status dari localStorage
      const savedStatus = localStorage.getItem('status_' + i);
      if(savedStatus === 'success'){
        card.style.borderColor = 'limegreen';
      } else if(savedStatus === 'proses'){
        card.style.borderColor = 'blue';
      } else {
        card.style.borderColor = 'transparent';
      }
    });

    updateStats();
    // Simpan data ke localStorage dengan key yang konsisten
    localStorage.setItem('robloxAccountsData', JSON.stringify(data));
    // Juga simpan untuk dibaca oleh status.html dengan key lama
    localStorage.setItem('robloxData', JSON.stringify(data));
  }

  // Initialize stats dan render
  renderData();
</script>
</body>
</html>
